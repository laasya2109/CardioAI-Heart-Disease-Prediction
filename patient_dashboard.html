<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CardioAI - My Health</title>
    <link rel="stylesheet" href="CSS/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="patient-body">

    <!-- Mobile-First Header -->
    <header class="p-header">
        <div class="p-logo"><i class="fas fa-heartbeat"></i> CardioAI</div>
        <button onclick="logout()" class="btn-icon-text"><i class="fas fa-sign-out-alt"></i> Logout</button>
    </header>

    <main class="p-container" style="max-width: 1200px; width: 95%;">

        <div
            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 30px; align-items: start;">
            <!-- Left Column: Hero & Actions -->
            <div style="display: flex; flex-direction: column; gap: 30px;">
                <!-- Hero Section -->
                <section class="p-hero" style="margin-bottom: 0;">
                    <div class="greeting-box">
                        <h1 id="pName">Hello, Patient</h1>
                        <div class="health-tip-bubble" id="dailyTip">
                            <i class="far fa-lightbulb"></i> Loading tip...
                        </div>
                    </div>

                    <!-- Health Gauge (Centerpiece) -->
                    <div class="gauge-wrapper">
                        <div class="gauge-container">
                            <svg viewBox="0 0 36 36" class="circular-chart orange">
                                <path class="circle-bg" d="M18 2.0845
                                    a 15.9155 15.9155 0 0 1 0 31.831
                                    a 15.9155 15.9155 0 0 1 0 -31.831" />
                                <path class="circle" id="healthCircle" stroke-dasharray="0, 100" d="M18 2.0845
                                    a 15.9155 15.9155 0 0 1 0 31.831
                                    a 15.9155 15.9155 0 0 1 0 -31.831" />
                                <text x="18" y="20.35" class="percentage" id="healthScore">0%</text>
                            </svg>
                        </div>
                        <p class="gauge-label">Heart Risk Score</p>
                    </div>

                    <!-- Dynamic Consult Button -->
                    <div id="consultButtonContainer" style="display: none; text-align: center; margin-top: 25px;">
                        <a id="consultLink" href="appointment.html"
                            style="background: #DC2626; color: white; padding: 12px 24px; border-radius: 50px; text-decoration: none; font-weight: 600; font-size: 1.1rem; display: inline-flex; align-items: center; gap: 8px; box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3); transition: 0.3s; cursor: pointer;">
                            <i class="fas fa-stethoscope"></i> Schedule Consultation
                        </a>
                    </div>
                </section>

                <!-- Actions -->
                <section
                    style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 10px 30px rgba(18, 194, 233, 0.08); margin-bottom: 30px;">
                    <h3 class="section-heading" style="margin-bottom: 20px;">Actions</h3>
                    <div style="display: flex; gap: 15px;">
                        <button onclick="window.location.href='records.html'" class="btn-outline"
                            style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 10px; padding: 20px;">
                            <i class="fas fa-file-alt" style="font-size: 1.5rem;"></i>
                            View Full History
                        </button>
                        <button onclick="downloadLatestReport()" class="btn-outline"
                            style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 10px; padding: 20px;">
                            <i class="fas fa-download" style="font-size: 1.5rem;"></i>
                            Download Report
                        </button>
                    </div>
                </section>

                <!-- Current Medications Section -->
                <section class="medications-card"
                    style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 10px 30px rgba(18, 194, 233, 0.08); margin-bottom: 30px;">
                    <h3 class="section-heading" style="margin-bottom: 20px; color: var(--secondary);"><i
                            class="fas fa-pills" style="color: var(--primary); margin-right: 8px;"></i>Current
                        Medications</h3>
                    <div id="patientPrescriptionsContainer"
                        style="display: flex; flex-direction: column; gap: 10px; max-height: 250px; overflow-y: auto; padding-right: 5px;">
                        <div style="text-align: center; color: var(--text-light); padding: 20px;">Loading medications...
                        </div>
                    </div>
                </section>

                <!-- Upcoming Appointments Section -->
                <section class="appointments-card"
                    style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 10px 30px rgba(18, 194, 233, 0.08);">
                    <h3 class="section-heading" style="margin-bottom: 20px;">Upcoming Appointments</h3>
                    <div id="patientAppointmentsContainer"
                        style="display: flex; flex-direction: column; gap: 15px; max-height: 280px; overflow-y: auto; padding-right: 5px;">
                        <div style="text-align: center; color: var(--text-light); padding: 20px;">Loading
                            appointments...
                        </div>
                    </div>
                </section>
            </div>

            <!-- Right Column: Vitals & History -->
            <div style="display: flex; flex-direction: column; gap: 30px;">
                <!-- Vitals Grid -->
                <section
                    style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 10px 30px rgba(18, 194, 233, 0.08);">
                    <h3 class="section-heading" style="margin-bottom: 20px;">Recent Vitals</h3>
                    <section class="vitals-grid" style="margin-bottom: 0;">
                        <div class="vital-card card-bp">
                            <div class="v-icon"><i class="fas fa-heartbeat"></i></div>
                            <div class="v-data">
                                <span class="v-value" id="v_bp">--</span>
                                <span class="v-unit">mmHg</span>
                            </div>
                            <p class="v-label">Blood Pressure</p>
                            <div class="v-status" id="s_bp">Normal</div>
                        </div>

                        <div class="vital-card card-chol">
                            <div class="v-icon"><i class="fas fa-tint"></i></div>
                            <div class="v-data">
                                <span class="v-value" id="v_chol">--</span>
                                <span class="v-unit">mg/dl</span>
                            </div>
                            <p class="v-label">Cholesterol</p>
                            <div class="v-status" id="s_chol">Good</div>
                        </div>

                        <div class="vital-card card-hr">
                            <div class="v-icon"><i class="fas fa-running"></i></div>
                            <div class="v-data">
                                <span class="v-value" id="v_hr">--</span>
                                <span class="v-unit">bpm</span>
                            </div>
                            <p class="v-label">Heart Rate</p>
                            <div class="v-status" id="s_hr">Resting</div>
                        </div>
                    </section>
                </section>

                <!-- Risk Trend Graph -->
                <section
                    style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 10px 30px rgba(18, 194, 233, 0.08); margin-bottom: 30px;">
                    <h3 class="section-heading" style="margin-bottom: 20px;">Risk Trend Over Time</h3>
                    <div style="width: 100%; height: 250px;">
                        <canvas id="riskTrendChart"></canvas>
                    </div>
                </section>

                <!-- History Section -->
                <section class="history-card"
                    style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 10px 30px rgba(18, 194, 233, 0.08); margin-bottom: 30px;">
                    <h3 class="section-heading" style="margin-bottom: 20px;">Previous Assessments</h3>
                    <div id="historyContainer"
                        style="display: flex; flex-direction: column; gap: 15px; max-height: 280px; overflow-y: auto; padding-right: 5px;">
                        <div style="text-align: center; color: var(--text-light); padding: 20px;">Loading history...
                        </div>
                    </div>
                </section>
            </div>
        </div>

    </main>

    <!-- Chat Widget -->
    <div id="chatWidget" class="chat-widget-fab" onclick="toggleChat()">
        <i class="fas fa-robot"></i>
        <span>Ask AI</span>
    </div>
    <div id="chatWindow" class="chat-window" style="display: none;">
        <div class="chat-header">
            <span><i class="fas fa-user-md"></i> CardioAI Assistant</span>
            <button onclick="toggleChat()"><i class="fas fa-times"></i></button>
        </div>
        <div class="chat-body" id="chatBody">
            <div class="msg bot">Hello! I can explain your health report or answer heart health questions. How can I
                help?</div>
        </div>
        <div class="chat-input">
            <input type="text" id="chatInput" placeholder="Type a message..." onkeypress="handleChat(event)">
            <button onclick="sendChat()"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <script src="JS/app.js?v=10"></script>
    <script>
        checkAuth(['Patient']);
        document.addEventListener('DOMContentLoaded', () => {
            loadPatientDashboard();
            loadAppointments();
        });
    </script>
</body>

</html>